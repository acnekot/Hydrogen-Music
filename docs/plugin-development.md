# Hydrogen Music æ’ä»¶å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç» Hydrogen Music æ¡Œé¢ç‰ˆçš„æ’ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ’ä»¶ç›®å½•ç»“æ„ã€å¼€å‘æµç¨‹ä»¥åŠåœ¨è®¾ç½®é¡µé¢ä¸­å¯¼å…¥ / å¯ç”¨ / ç¦ç”¨ / åˆ é™¤æ’ä»¶çš„æ–¹æ³•ã€‚

## æ’ä»¶æ‰“åŒ…ä¸ç›®å½•ç»“æ„

Hydrogen Music ç›®å‰æ”¯æŒ**ç›®å½•å½¢å¼**çš„æ’ä»¶åŒ…ã€‚æ¯ä¸ªæ’ä»¶ç›®å½•éœ€è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
my-awesome-plugin/
â”œâ”€ manifest.json   # æ’ä»¶å…ƒæ•°æ®
â””â”€ main.js         # æ’ä»¶å…¥å£è„šæœ¬ï¼Œå¯æ ¹æ®éœ€è¦æ‹†åˆ†æ›´å¤šæ–‡ä»¶
```

> ğŸ“¦ å‘å¸ƒæ’ä»¶æ—¶å¯ä»¥å°†æ•´ä¸ªç›®å½•å‹ç¼©åˆ†å‘ï¼Œä½†åœ¨åº”ç”¨ä¸­å¯¼å…¥æ—¶å¿…é¡»å…ˆè§£å‹ï¼Œå†é€‰æ‹©æ’ä»¶æ ¹ç›®å½•ã€‚

### manifest.json

`manifest.json` ç”¨äºæè¿°æ’ä»¶çš„åŸºç¡€ä¿¡æ¯ï¼Œå¿…å¡«å­—æ®µå¦‚ä¸‹ï¼š

| å­—æ®µå    | ç±»å‹   | è¯´æ˜ |
|----------|--------|------|
| `id`     | string | æ’ä»¶å”¯ä¸€ IDï¼Œä»…å…è®¸å­—æ¯ã€æ•°å­—ã€`.`ã€`_`ã€`-`ï¼Œå¯¼å…¥æ—¶åŒ ID ä¼šè¦†ç›–æ—§ç‰ˆæœ¬ |
| `name`   | string | å±•ç¤ºåç§° |
| `version`| string | æ’ä»¶ç‰ˆæœ¬å· |
| `main`   | string | å…¥å£è„šæœ¬ï¼ˆç›¸å¯¹äºæ’ä»¶æ ¹ç›®å½•çš„è·¯å¾„ï¼Œç¦æ­¢ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ– `..`ï¼‰ |

å¯é€‰å­—æ®µï¼š

- `description`ï¼šæ’ä»¶ç®€ä»‹ã€‚
- `author`ï¼šä½œè€…åç§°ã€‚
- `homepage`ï¼šé¡¹ç›®ä¸»é¡µæˆ–ä»“åº“é“¾æ¥ã€‚

ç¤ºä¾‹ï¼š

```json
{
  "id": "example.hello-world",
  "name": "Hello World",
  "version": "1.0.0",
  "author": "Hydrogen Labs",
  "description": "ç¤ºä¾‹æ’ä»¶ï¼Œæ¼”ç¤ºæ’ä»¶ç”Ÿå‘½å‘¨æœŸ APIã€‚",
  "homepage": "https://github.com/acnekot/Hydrogen-Music",
  "main": "main.js"
}
```

## æ’ä»¶å…¥å£è„šæœ¬

æ’ä»¶å…¥å£è„šæœ¬é‡‡ç”¨ CommonJS è¯­æ³•ã€‚å…¥å£éœ€è¦å¯¼å‡ºä¸€ä¸ªå¸¦æœ‰ `activate`ï¼ˆå¿…éœ€ï¼‰å’Œ `deactivate`ï¼ˆå¯é€‰ï¼‰çš„å¯¹è±¡ï¼Œæˆ–ç›´æ¥å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼ˆç­‰ä»·äº `activate`ï¼‰ï¼š

```js
// main.js
module.exports = {
  activate(context) {
    context.utils.notice('Hello, Hydrogen!');

    const route = context.router.addRoute({
      path: '/hello-plugin',
      name: 'HelloPlugin',
      component: {
        template: '<div style="padding:24px">æ¥è‡ªæ’ä»¶çš„é¡µé¢ âœ¨</div>'
      }
    });

    context.onCleanup(() => {
      context.router.removeRoute(route.name);
    });
  },

  deactivate(context) {
    context.utils.notice('æ’ä»¶å·²ç¦ç”¨');
  }
};
```

### `activate(context)`

å¯ç”¨æ’ä»¶æ—¶è°ƒç”¨ï¼Œ`context` æä¾›ä»¥ä¸‹èƒ½åŠ›ï¼š

| å±æ€§ | è¯´æ˜ |
|------|------|
| `app` | Vue åº”ç”¨å®ä¾‹ï¼Œå¯ç”¨äºæ³¨å†Œå…¨å±€ç»„ä»¶ã€æŒ‡ä»¤ç­‰ |
| `router` | Vue Router å®ä¾‹ï¼Œå¯åŠ¨æ€æ·»åŠ è·¯ç”± |
| `pinia` | Pinia æ ¹å®ä¾‹ |
| `stores` | å¸¸ç”¨ Pinia store å®ä¾‹ `{ player, user, library, local, other, cloud }` |
| `metadata` | æ’ä»¶çš„ manifest ä¿¡æ¯ï¼ˆ`id/name/version/...`ï¼‰ |
| `plugin` | æ’ä»¶ç›¸å…³å·¥å…·ï¼Œå¦‚ `plugin.readText(path)`ã€`plugin.readBase64(path)` è¯»å–æ’ä»¶å†…æ–‡ä»¶ |
| `windowApi` / `electronAPI` | é¢„åŠ è½½è„šæœ¬æš´éœ²çš„åŸç”Ÿèƒ½åŠ›ï¼Œä¸åº”ç”¨å†…éƒ¨è°ƒç”¨ä¸€è‡´ |
| `utils.notice(message, duration)` | è°ƒç”¨åº”ç”¨å†…çš„æ¶ˆæ¯æç¤ºï¼ˆå•ä½ï¼šç§’ï¼‰ |
| `onCleanup(callback)` | æ³¨å†Œæ¸…ç†é€»è¾‘ï¼Œåœ¨ç¦ç”¨æˆ–å¸è½½æ—¶è‡ªåŠ¨è°ƒç”¨ |

### `deactivate(context)`

æ’ä»¶è¢«ç¦ç”¨æˆ–å¸è½½å‰è°ƒç”¨ï¼Œç”¨äºæ‰‹åŠ¨å›æ”¶èµ„æºï¼ˆå¦‚ç§»é™¤äº‹ä»¶ç›‘å¬ã€æ¸…ç† DOM ç­‰ï¼‰ã€‚è‹¥åœ¨ `activate` ä¸­é€šè¿‡ `onCleanup` æ³¨å†Œäº†æ¸…ç†å‡½æ•°ï¼Œå¯ä¸å†å®ç° `deactivate`ã€‚

## è¯»å–æ’ä»¶å†…çš„æ–‡ä»¶

ä½¿ç”¨ `context.plugin.readText('data/config.json')` è¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œè¿”å› Promise<string>ã€‚å¦‚éœ€è·å–äºŒè¿›åˆ¶ / å›¾ç‰‡ï¼Œå¯ä½¿ç”¨ `readBase64` å¹¶æ‰‹åŠ¨è½¬æ¢ï¼š

```js
const coverBase64 = await context.plugin.readBase64('assets/cover.png');
const imgSrc = `data:image/png;base64,${coverBase64}`;
```

## åœ¨åº”ç”¨ä¸­ç®¡ç†æ’ä»¶

1. æ‰“å¼€ **è®¾ç½® â†’ æ’ä»¶**ã€‚
2. ç‚¹å‡» **å¯¼å…¥æ’ä»¶**ï¼Œé€‰æ‹©åŒ…å« `manifest.json` çš„æ’ä»¶ç›®å½•ã€‚
3. æ’ä»¶å¯¼å…¥åé»˜è®¤å¯ç”¨ï¼Œå¯éšæ—¶ç‚¹å‡» **ç¦ç”¨ / å¯ç”¨** æŒ‰é’®åˆ‡æ¢çŠ¶æ€ã€‚
4. ç‚¹å‡» **åˆ é™¤** å¯ç§»é™¤æ’ä»¶å¹¶æ¸…ç†æ’ä»¶æ–‡ä»¶ã€‚
5. ä½¿ç”¨ **åˆ·æ–°åˆ—è¡¨** é‡æ–°è¯»å–æ’ä»¶ä¿¡æ¯ï¼ˆä¾‹å¦‚æ‰‹åŠ¨ä¿®æ”¹æ’ä»¶æ–‡ä»¶åï¼‰ã€‚

> é»˜è®¤æƒ…å†µä¸‹ï¼Œæ’ä»¶ä¼šè¢«å¤åˆ¶åˆ°åº”ç”¨æ ¹ç›®å½•ä¸‹çš„ `plugins/<æ’ä»¶ID>`ï¼ˆæ‰“åŒ…ç‰ˆä½äºå¯æ‰§è¡Œæ–‡ä»¶åŒçº§ç›®å½•ï¼Œå¼€å‘ç¯å¢ƒä½äºé¡¹ç›®æ ¹ç›®å½•ï¼‰ã€‚
> å¯ä»¥åœ¨ **è®¾ç½® â†’ æ’ä»¶** ä¸­ä¿®æ”¹æ’ä»¶å­˜å‚¨ä½ç½®æˆ–ç‚¹å‡»æ—è¾¹çš„â€œé‡ç½®â€æ¢å¤é»˜è®¤ç›®å½•ï¼Œä¿®æ”¹æ—¶åº”ç”¨ä¼šæç¤ºæ˜¯å¦è¿ç§»ç°æœ‰æ’ä»¶æ–‡ä»¶ã€‚
> é‡å¤å¯¼å…¥åŒ ID æ’ä»¶ä¼šè¦†ç›–æ—§ç‰ˆæœ¬å¹¶ä¿ç•™å¯ç”¨çŠ¶æ€ã€‚éœ€è¦é‡æ–°åŠ è½½æ‰€æœ‰æ’ä»¶æ—¶ï¼Œå¯ä½¿ç”¨å·¥å…·æ çš„â€œé‡è½½â€æŒ‰é’®åˆ·æ–°æ•´ä¸ªåº”ç”¨ã€‚

## å¼€å‘å»ºè®®

- é¿å…ç›´æ¥è®¿é—® Node.js å†…ç½®æ¨¡å—ï¼Œæ¸²æŸ“è¿›ç¨‹é»˜è®¤ç¦ç”¨ `require`ã€‚
- é€šè¿‡ `windowApi` è°ƒç”¨ Electron ä¸»è¿›ç¨‹æä¾›çš„ APIï¼Œä¸åº”ç”¨å†…éƒ¨ä¿æŒä¸€è‡´ã€‚
- æ’ä»¶é€»è¾‘åº”è€ƒè™‘å¼‚å¸¸æ•è·ï¼Œé˜²æ­¢å½±å“ä¸»åº”ç”¨ç¨³å®šæ€§ã€‚
- å»ºè®®åœ¨ `deactivate` ä¸­æ’¤é”€æ³¨å†Œçš„è·¯ç”±ã€äº‹ä»¶ç›‘å¬å’Œå…¨å±€å‰¯ä½œç”¨ã€‚

ç¥ä½ å¼€å‘æ„‰å¿«ï¼
